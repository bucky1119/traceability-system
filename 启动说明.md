# 设施蔬菜溯源系统启动说明

## 系统概述

本系统包含三个主要组件：
1. **后端API服务** (NestJS + MySQL) - 端口 3000
2. **Web管理后台** (React + Ant Design) - 端口 3001
3. **微信小程序** (微信原生开发)

## 快速启动

### 方法一：使用启动脚本（推荐）

#### Windows用户
```bash
# 双击运行
start-system.bat
```

#### Linux/Mac用户
```bash
# 给脚本执行权限
chmod +x start-system.sh

# 运行启动脚本
./start-system.sh
```

### 方法二：手动启动

#### 1. 启动后端服务
```bash
cd backend
npm install
npm run start:dev
```

#### 2. 启动Web管理后台
```bash
cd web-admin
npm install
npm start
```

#### 3. 打开微信小程序
- 打开微信开发者工具
- 导入项目：选择 `miniprogram` 目录
- 配置AppID（如需要）

## 访问地址

- **后端API**: http://localhost:3000
- **API文档**: http://localhost:3000/api
- **Web管理后台**: http://localhost:3001
- **微信小程序**: 在微信开发者工具中预览

## 默认账号

### 管理员账号
- 用户名: `admin`
- 密码: `admin123`

### 生产者账号
- 用户名: `producer1`
- 密码: `producer123`

### 消费者账号
- 用户名: `consumer1`
- 密码: `consumer123`

## 环境要求

- Node.js 16+
- MySQL 8.0+
- 微信开发者工具

## 数据库配置

1. 创建数据库：
```sql
CREATE DATABASE traceability_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. 配置环境变量：
```bash
cd backend
cp .env.example .env
# 编辑 .env 文件，配置数据库连接信息
```

## 常见问题

### 1. 端口冲突解决
系统已配置端口分配：
- 后端服务：3000端口
- Web管理后台：3001端口

如果仍有端口冲突，可以修改：
- 后端：修改 `backend/src/main.ts` 中的端口号
- 前端：修改 `web-admin/package.json` 中的 `start` 脚本

### 2. 数据库连接失败
- 检查MySQL服务是否启动
- 确认数据库用户名和密码正确
- 检查防火墙设置

### 3. 前端启动失败
- 检查Node.js版本
- 删除 `node_modules` 重新安装
- 检查网络连接

### 4. 微信小程序无法预览
- 检查微信开发者工具版本
- 确认小程序AppID配置
- 检查网络连接

## 开发模式

### 后端开发
```bash
cd backend
npm run start:dev  # 开发模式，支持热重载
```

### 前端开发
```bash
cd web-admin
npm start  # 开发模式，支持热重载
```

### 微信小程序开发
- 在微信开发者工具中直接编辑
- 支持实时预览和调试

## 生产部署

### 构建前端
```bash
cd web-admin
npm run build
```

### 启动生产服务
```bash
cd backend
npm run start:prod
```

## 技术支持

如有问题，请查看：
1. 控制台错误信息
2. 网络请求状态
3. 数据库连接日志
4. 项目说明文档

## 系统功能

### 微信小程序
- 扫码查询产品溯源信息
- 查看历史扫描记录
- 产品详情展示

### Web管理后台
- **仪表盘**: 系统统计、图表展示、最近扫描记录
- **用户管理**: 用户列表、添加编辑删除、搜索、统计
- **企业管理**: 企业信息管理、类型分类、状态管理
- **产品管理**: 产品信息管理、类别分类、检测状态
- **二维码管理**: 二维码生成、批量生成、下载、统计

### 后端API
- 用户认证
- 数据管理
- 二维码生成
- 溯源查询

## 新增功能

### Web管理后台新增页面
1. **企业管理页面**
   - 企业列表展示
   - 添加/编辑/删除企业
   - 企业类型分类（生产者/经销商/零售商）
   - 企业状态管理
   - 统计信息展示

2. **产品管理页面**
   - 产品列表展示
   - 添加/编辑/删除产品
   - 产品类别分类（蔬菜/水果/粮食）
   - 检测状态管理
   - 产品图片展示
   - 统计信息展示

3. **二维码管理页面**
   - 二维码列表展示
   - 单个/批量生成二维码
   - 二维码下载功能
   - 扫描次数统计
   - 使用率分析
   - 统计信息展示

### 端口冲突解决方案
- 后端服务固定使用3000端口
- Web管理后台固定使用3001端口
- 修改package.json中的启动脚本，避免端口冲突 