
# 溯源系统后端接口文档

## 域名：
（请补充实际域名）

## 测试环境：
（请补充测试环境地址）

## 生产环境：
（请补充生产环境地址）

用户/认证相关（登录、注册、获取用户、用户管理等）
产品相关（公共/我的/合格产品列表、详情、创建、更新、删除、导出等）
二维码相关（创建、批量生成、列表、详情、图片、统计、解析、溯源等）
企业相关（公共/私有列表、详情、创建、更新、删除、按名称/执照号查询等）
批次相关（创建、列表、详情、统计、更新、删除、按编号查等）
管理员相关（农户、产品、企业、二维码统计、录入、导出等）
文件上传（图片上传）
角色管理（如有需要可补充）



## 接口列表


### 登录
接口地址：/auth/login
请求方式：POST
请求参数：
```
username: string  // 用户名/手机号/微信code
password: string  // 密码（如有）
```
返回数据：
```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "token": "xxx",
        "token_type": "bearer",
        "expires_in": 2591999,
        "user": {
            "id": 1,
            "nickname": "张三",
            "mobile": "",
            "avatar": "",
            "gender": 0
        }
    }
}
```


### 注册
接口地址：/auth/register
请求方式：POST
请求参数：
```
username: string  // 用户名/手机号/微信code
password: string  // 密码
nickname: string  // 昵称
avatar: string    // 头像
gender: number    // 性别
```
返回数据：
```json
{
    "code": 0,
    "msg": "注册成功",
    "data": {
        "userId": 123,
        "token": "xxx"
    }
}
```


### 获取当前用户信息
接口地址：/auth/me
请求方式：GET
请求参数：
```
header需携带token
```
返回数据：
```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "id": 1,
        "nickname": "张三",
        "mobile": "138****8888",
        "avatar": "",
        "gender": 1
    }
}
```

#### 用户管理（需管理员权限）
 创建用户：POST `/users`
 获取用户列表：GET `/users`
 获取用户详情：GET `/users/:id`
 更新用户：PATCH `/users/:id`
 删除用户：DELETE `/users/:id`



### 产品相关

#### 公共产品列表（无需登录）
 接口地址：`/products/public`
 请求方式：GET
 请求参数：
| 参数名 | 类型   | 必填 | 说明     |
|  |  |  |  |
| name   | string | 否   | 产品名称 |
| origin | string | 否   | 产地     |

 返回数据：
```json
{
    "code": 0,
    "msg": "success",
    "data": [
        { "id": 1, "name": "蔬菜A", "image": "xxx.jpg" }
    ]
}
```

#### 合格产品列表
 接口地址：`/products/qualified`
 请求方式：GET
 返回数据：同上

#### 我的产品列表
 接口地址：`/products/my`
 请求方式：GET
 header需携带token
 返回数据：同上

#### 产品统计
 接口地址：`/products/stats`
 请求方式：GET
 header需携带token
 返回数据：
```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "total": 10,
        "qualified": 8
    }
}
```

#### 导出农户检测结果
 接口地址：`/products/export`
 请求方式：GET
 header需携带token
 请求参数：farmerId（可选）

#### 创建产品
 接口地址：`/products`
 请求方式：POST
 header需携带token
 请求参数：CreateProductDto

#### 管理员录入产品
 接口地址：`/products/admin`
 请求方式：POST
 header需携带token
 请求参数：CreateProductDto

#### 获取产品列表
 接口地址：`/products`
 请求方式：GET
 header需携带token
 请求参数：producerId、name、origin（可选）

#### 获取产品详情
 接口地址：`/products/:id`
 请求方式：GET
 返回数据：
```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "id": 1,
        "name": "蔬菜A",
        "desc": "绿色有机蔬菜",
        "image": "xxx.jpg"
    }
}
```

#### 更新产品
 接口地址：`/products/:id`
 请求方式：PATCH
 header需携带token
 请求参数：UpdateProductDto

#### 删除产品
 接口地址：`/products/:id`
 请求方式：DELETE
 header需携带token



### 二维码相关

#### 创建二维码
 接口地址：`/qrcodes`
 请求方式：POST
 header需携带token
 请求参数：CreateQrcodeDto

#### 批量生成二维码
 接口地址：`/qrcodes/batch/:batchId/:count`
 请求方式：POST
 header需携带token

#### 获取二维码列表
 接口地址：`/qrcodes`
 请求方式：GET
 header需携带token
 请求参数：batchId、productId（可选）

#### 二维码统计
 接口地址：`/qrcodes/stats`
 请求方式：GET
 header需携带token

#### 扫描二维码
 接口地址：`/qrcodes/scan/:qrcodeId`
 请求方式：GET

#### 查询产品溯源信息
 接口地址：`/qrcodes/trace/:qrcodeId`
 请求方式：GET

#### 解析二维码溯源信息
 接口地址：`/qrcodes/decode`
 请求方式：POST
 请求参数：qrcodeData（二维码内容）
 返回数据：
```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "productId": 1,
        "batchId": 2
    }
}
```

#### 获取二维码图片
 接口地址：`/qrcodes/image/:qrcodeId`
 请求方式：GET

#### 获取二维码图片信息
 接口地址：`/qrcodes/imageinfo/:qrcodeId`
 请求方式：GET
 header需携带token

#### 下载二维码图片
 接口地址：`/qrcodes/download/:qrcodeId`
 请求方式：GET

#### 预览二维码图片
 接口地址：`/qrcodes/preview/:qrcodeId`
 请求方式：GET

#### 根据二维码ID查询二维码
 接口地址：`/qrcodes/id/:qrcodeId`
 请求方式：GET
 header需携带token

#### 更新二维码
 接口地址：`/qrcodes/:id`
 请求方式：PATCH
 header需携带token

#### 删除二维码
 接口地址：`/qrcodes/:id`
 请求方式：DELETE
 header需携带token

#### 获取二维码详情
 接口地址：`/qrcodes/:id`
 请求方式：GET
 header需携带token



### 企业相关

#### 公共企业列表
 接口地址：`/enterprises/public`
 请求方式：GET

#### 创建企业
 接口地址：`/enterprises`
 请求方式：POST
 header需携带token
 请求参数：CreateEnterpriseDto

#### 获取企业列表
 接口地址：`/enterprises`
 请求方式：GET
 header需携带token

#### 根据营业执照号查询企业
 接口地址：`/enterprises/search/license/:license`
 请求方式：GET
 header需携带token

#### 根据企业名称查询企业
 接口地址：`/enterprises/search/name/:name`
 请求方式：GET
 header需携带token

#### 获取企业详情
 接口地址：`/enterprises/:id`
 请求方式：GET
 header需携带token

#### 更新企业
 接口地址：`/enterprises/:id`
 请求方式：PATCH
 header需携带token

#### 删除企业
 接口地址：`/enterprises/:id`
 请求方式：DELETE
 header需携带token



### 批次相关

#### 创建批次
 接口地址：`/batches`
 请求方式：POST
 header需携带token
 请求参数：CreateBatchDto

#### 获取批次列表
 接口地址：`/batches`
 请求方式：GET
 header需携带token
 请求参数：productId（可选）

#### 批次统计
 接口地址：`/batches/stats`
 请求方式：GET
 header需携带token

#### 根据批次编号查询
 接口地址：`/batches/code/:batchCode`
 请求方式：GET
 header需携带token

#### 获取批次详情
 接口地址：`/batches/:id`
 请求方式：GET
 header需携带token

#### 更新批次
 接口地址：`/batches/:id`
 请求方式：PATCH
 header需携带token

#### 删除批次
 接口地址：`/batches/:id`
 请求方式：DELETE
 header需携带token



### 管理员相关

#### 获取农户列表
 接口地址：`/admin/farmers`
 请求方式：GET
 header需携带管理员token

#### 为农户录入产品
 接口地址：`/admin/products`
 请求方式：POST
 header需携带管理员token
 请求参数：CreateFarmerProductDto

#### 导出产品信息
 接口地址：`/admin/products/export`
 请求方式：GET
 header需携带管理员token
 请求参数：farmerId、startDate、endDate（可选）

#### 获取系统统计信息
 接口地址：`/admin/stats`
 请求方式：GET
 header需携带管理员token

#### 获取产品统计信息
 接口地址：`/admin/products/stats`
 请求方式：GET
 header需携带管理员token

#### 获取指定农户的产品列表
 接口地址：`/admin/farmers/:id/products`
 请求方式：GET
 header需携带管理员token

#### 获取企业统计信息
 接口地址：`/admin/enterprises`
 请求方式：GET
 header需携带管理员token

#### 获取二维码统计信息
 接口地址：`/admin/qrcodes/stats`
 请求方式：GET
 header需携带管理员token



### 文件上传

#### 上传图片
 接口地址：`/upload/image`
 请求方式：POST
 header需携带token
 ContentType: multipart/formdata，字段名image
 返回数据：图片url等



如需详细补充每个接口的参数、返回值、说明等，请告知需要哪些模块或接口，我可以继续为你整理。

| 参数名   | 类型   | 必填 | 说明         |
|  |  |  |  |
| qrcode   | string | 是   | 二维码内容   |

 返回数据：
```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "productId": 1,
        "batchId": 2
    }
}
```



### 其他接口
 还包括企业管理、批次管理、溯源信息、用户管理、上传图片等接口，具体可根据 backend/src/modules/ 下各 controller 文件补充。



如需详细补充每个接口的参数、返回值、说明等，请告知需要哪些模块或接口，我可以继续为你整理。
