# 蔬菜溯源系统小程序

## 项目概述

这是一个基于微信小程序的蔬菜溯源系统，主要面向农户和消费者，提供产品信息录入、二维码生成、溯源查询等功能。

## 功能特性

### 🏠 首页（产品展示）
- **产品列表展示**：展示所有录入的蔬菜产品
- **搜索功能**：支持按产品名称和批次编号搜索
- **筛选排序**：支持按合格状态筛选和时间/名称排序
- **扫码溯源**：集成微信扫码功能，支持二维码溯源查询
- **产品卡片**：展示产品基本信息、状态和操作按钮

### 👤 用户中心（登录/注册）
- **用户注册**：支持农户注册，包含角色选择和企业关联
- **用户登录**：JWT token认证，支持自动登录
- **个人信息**：展示用户基本信息、统计数据
- **功能入口**：快速跳转到产品管理和录入功能

### 📝 产品录入
- **表单验证**：产品名称和批次编号必填验证
- **信息录入**：支持完整的蔬菜信息录入
  - 基本信息：产品名称、批次编号、产地
  - 时间信息：种植日期、收获日期
  - 检测信息：检测类型、检测日期、检测报告、合格状态
  - 其他信息：产品图片、批次备注
- **自动生成二维码**：提交后自动生成产品溯源二维码
- **二维码管理**：支持预览、下载、保存到相册

### 📋 我的产品
- **产品管理**：展示用户录入的所有产品
- **统计信息**：显示产品数量、二维码数量、扫码次数
- **搜索筛选**：支持关键词搜索和状态筛选
- **操作功能**：编辑、生成二维码、删除产品
- **二维码弹窗**：生成二维码后可直接预览和下载

### 🔍 产品详情
- **详细信息展示**：完整的产品溯源信息
  - 种植信息：种植日期、收获日期、产地
  - 检测信息：检测类型、检测日期、检测结果
  - 生产者信息：生产者姓名、联系方式、所属企业
  - 批次信息：批次编号、创建时间、备注
  - 二维码信息：二维码列表、扫码次数
- **操作功能**：编辑产品、生成二维码、删除产品

## 技术架构

### 前端技术栈
- **微信小程序原生开发**
- **WXML + WXSS + JavaScript**
- **模块化API调用**
- **响应式设计**

### 后端接口
- **RESTful API设计**
- **JWT认证机制**
- **文件上传下载**
- **二维码生成和管理**

### 数据存储
- **本地存储**：用户信息、登录状态
- **云端数据库**：产品信息、用户信息、二维码数据
- **文件存储**：二维码图片、产品图片

## 页面结构

```
pages/
├── index/              # 首页 - 产品展示列表
├── detail/             # 产品详情页
├── input/              # 产品录入页
├── myVegetables/       # 我的产品列表页
└── userCenter/         # 用户中心页

utils/
├── api.js              # API接口封装
└── util.js             # 工具函数
```

## API接口

### 认证相关
- `POST /auth/login` - 用户登录
- `POST /auth/register` - 用户注册
- `GET /users/profile` - 获取用户信息

### 产品相关
- `GET /products` - 获取产品列表
- `POST /products` - 创建产品
- `GET /products/:id` - 获取产品详情
- `PATCH /products/:id` - 更新产品
- `DELETE /products/:id` - 删除产品
- `GET /products/my` - 获取我的产品

### 二维码相关
- `POST /qrcodes` - 创建二维码
- `GET /qrcodes` - 获取二维码列表
- `GET /qrcodes/:id` - 获取二维码详情
- `GET /qrcodes/image-info/:qrcodeId` - 获取二维码图片信息
- `GET /qrcodes/download/:qrcodeId` - 下载二维码图片
- `GET /qrcodes/preview/:qrcodeId` - 预览二维码图片
- `GET /qrcodes/trace/:qrcodeId` - 查询溯源信息
- `POST /qrcodes/decode` - 解析二维码数据

## 使用流程

### 农户使用流程
1. **注册登录**：在用户中心注册农户账号
2. **录入产品**：在产品录入页面填写蔬菜信息
3. **生成二维码**：系统自动生成产品溯源二维码
4. **管理产品**：在我的产品页面管理所有产品
5. **查看详情**：点击产品查看详细信息

### 消费者使用流程
1. **浏览产品**：在首页浏览所有蔬菜产品
2. **扫码溯源**：使用扫码功能扫描产品二维码
3. **查看信息**：获取完整的产品溯源信息
4. **搜索产品**：通过搜索功能查找特定产品

## 开发环境

### 环境要求
- **微信开发者工具**：最新版本
- **Node.js**：14.0+
- **后端服务**：NestJS + MySQL

### 配置说明
1. **API地址配置**：在 `utils/api.js` 中修改 `BASE_URL`
2. **数据库配置**：确保后端服务正常运行
3. **小程序配置**：在微信开发者工具中导入项目

### 本地开发
```bash
# 1. 启动后端服务
cd backend
npm install
npm run start:dev

# 2. 导入小程序项目
# 使用微信开发者工具打开 miniprogram-1 目录

# 3. 配置服务器域名
# 在微信公众平台配置服务器域名白名单
```

## 部署说明

### 小程序发布
1. **代码审核**：在微信开发者工具中提交审核
2. **版本发布**：审核通过后发布正式版本
3. **域名配置**：确保API域名已在小程序后台配置

### 后端部署
1. **服务器部署**：将后端代码部署到服务器
2. **数据库配置**：配置生产环境数据库
3. **域名配置**：配置HTTPS域名
4. **环境变量**：配置生产环境变量

## 安全考虑

### 数据安全
- **JWT认证**：所有API请求都需要有效的JWT token
- **数据验证**：前后端双重数据验证
- **权限控制**：基于角色的权限控制

### 网络安全
- **HTTPS协议**：所有API请求使用HTTPS
- **域名白名单**：小程序域名白名单配置
- **请求限制**：API请求频率限制

## 性能优化

### 前端优化
- **图片压缩**：产品图片自动压缩
- **懒加载**：列表页面支持懒加载
- **缓存策略**：合理使用本地缓存

### 后端优化
- **数据库索引**：关键字段建立索引
- **缓存机制**：热点数据缓存
- **分页查询**：大数据量分页处理

## 常见问题

### Q: 扫码功能无法使用？
A: 确保已在微信公众平台配置扫码相关权限，并在小程序后台配置服务器域名。

### Q: 图片上传失败？
A: 检查后端文件上传配置，确保上传目录有写入权限。

### Q: 二维码生成失败？
A: 检查后端二维码生成服务是否正常，确保相关依赖已安装。

### Q: 登录状态丢失？
A: 检查JWT token是否过期，确保token刷新机制正常工作。

## 更新日志

### v1.0.0 (2024-01-01)
- ✅ 完成基础功能开发
- ✅ 实现用户注册登录
- ✅ 实现产品信息录入
- ✅ 实现二维码生成和管理
- ✅ 实现溯源信息查询
- ✅ 完成小程序界面设计

## 联系方式

如有问题或建议，请联系开发团队。

---

**注意**：本项目仅供学习和演示使用，生产环境使用前请进行充分的安全测试和性能优化。 