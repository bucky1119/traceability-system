<!--userCenter.wxml-->
<view class="container">
  <!-- 用户信息卡片 -->
  <view class="user-card" wx:if="{{userInfo}}">
    <view class="user-avatar">
      <image src="{{userInfo.avatar || '/images/default-product.jpg'}}" mode="aspectFill"/>
    </view>
    <view class="user-info">
      <text class="user-name">{{userInfo.username}}</text>
      <text class="user-role">{{userInfo.role === 'admin' ? '管理员' : '农户'}}</text>
      <text class="user-enterprise" wx:if="{{userInfo.enterprise}}">{{userInfo.enterprise}}</text>
    </view>
  </view>

  <!-- 统计数据 -->
  <view class="stats-section" wx:if="{{userInfo}}">
    <view class="stat-card">
      <text class="stat-number">{{stats.productCount}}</text>
      <text class="stat-label">产品数量</text>
    </view>
    <view class="stat-card">
      <text class="stat-number">{{stats.qrcodeCount}}</text>
      <text class="stat-label">二维码</text>
    </view>
    <view class="stat-card">
      <text class="stat-number">{{stats.scanCount}}</text>
      <text class="stat-label">扫码次数</text>
    </view>
  </view>

  <!-- 管理员功能模块 -->
  <view class="admin-section" wx:if="{{userInfo && userInfo.role === 'admin'}}">
    <view class="section-title">管理员功能</view>
    
    <view class="admin-actions">
      <view class="action-item" bindtap="goToFarmerInput">
        <view class="action-icon">👨‍🌾</view>
        <text class="action-text">农户产品录入</text>
        <text class="action-desc">为指定农户录入产品信息</text>
      </view>
      
      <view class="action-item" bindtap="goToProductExport">
        <view class="action-icon">📊</view>
        <text class="action-text">产品信息导出</text>
        <text class="action-desc">导出不同农户的产品信息</text>
      </view>
      
      <view class="action-item" bindtap="goToFarmerManagement">
        <view class="action-icon">👥</view>
        <text class="action-text">农户管理</text>
        <text class="action-desc">管理农户信息和权限</text>
      </view>
      
      <view class="action-item" bindtap="goToSystemStats">
        <view class="action-icon">📈</view>
        <text class="action-text">系统统计</text>
        <text class="action-desc">查看系统整体数据统计</text>
      </view>
    </view>
  </view>

  <!-- 普通用户功能模块 -->
  <view class="user-section" wx:if="{{userInfo && userInfo.role !== 'admin'}}">
    <view class="section-title">我的功能</view>
    
    <view class="user-actions">
      <view class="action-item" bindtap="goToMyProducts">
        <view class="action-icon">🥬</view>
        <text class="action-text">我的产品</text>
        <text class="action-desc">查看和管理我的产品</text>
      </view>
      
      <view class="action-item" bindtap="goToInput">
        <view class="action-icon">➕</view>
        <text class="action-text">录入产品</text>
        <text class="action-desc">录入新的产品信息</text>
      </view>
      
      <view class="action-item" bindtap="goToQrcodeManagement">
        <view class="action-icon">📱</view>
        <text class="action-text">二维码管理</text>
        <text class="action-desc">管理产品二维码</text>
      </view>
      
      <view class="action-item" bindtap="goToProfile">
        <view class="action-icon">👤</view>
        <text class="action-text">个人信息</text>
        <text class="action-desc">修改个人信息</text>
      </view>
    </view>
  </view>

  <!-- 登录/注册表单 -->
  <view class="auth-section" wx:if="{{!userInfo}}">
    <view class="auth-tabs">
      <text 
        class="tab-item {{!isRegister ? 'active' : ''}}" 
        bindtap="switchToLogin"
      >
        登录
      </text>
      <text 
        class="tab-item {{isRegister ? 'active' : ''}}" 
        bindtap="switchToRegister"
      >
        注册
      </text>
    </view>

    <!-- 登录表单 -->
    <view class="auth-form" wx:if="{{!isRegister}}">
      <view class="form-item">
        <text class="label">用户名</text>
        <input 
          class="input" 
          placeholder="请输入用户名" 
          value="{{loginForm.username}}"
          bindinput="onLoginInput"
          data-field="username"
        />
      </view>
      
      <view class="form-item">
        <text class="label">密码</text>
        <input 
          class="input" 
          placeholder="请输入密码" 
          password="true"
          value="{{loginForm.password}}"
          bindinput="onLoginInput"
          data-field="password"
        />
      </view>
      
      <button 
        class="btn-primary" 
        bindtap="handleLogin"
        loading="{{loginLoading}}"
      >
        登录
      </button>
    </view>

    <!-- 注册表单 -->
    <view class="auth-form" wx:if="{{isRegister}}">
      <view class="form-item">
        <text class="label">用户名</text>
        <input 
          class="input" 
          placeholder="请输入用户名" 
          value="{{registerForm.username}}"
          bindinput="onRegisterInput"
          data-field="username"
        />
      </view>
      
      <view class="form-item">
        <text class="label">密码</text>
        <input 
          class="input" 
          placeholder="请输入密码" 
          password="true"
          value="{{registerForm.password}}"
          bindinput="onRegisterInput"
          data-field="password"
        />
      </view>
      
      <view class="form-item">
        <text class="label">确认密码</text>
        <input 
          class="input" 
          placeholder="请再次输入密码" 
          password="true"
          value="{{registerForm.confirmPassword}}"
          bindinput="onRegisterInput"
          data-field="confirmPassword"
        />
      </view>
      
      <view class="form-item">
        <text class="label">手机号</text>
        <input 
          class="input" 
          placeholder="请输入手机号" 
          value="{{registerForm.tel}}"
          bindinput="onRegisterInput"
          data-field="tel"
        />
      </view>
      
      <view class="form-item">
        <text class="label">所属企业</text>
        <picker 
          mode="selector" 
          range="{{enterprises}}" 
          range-key="name"
          value="{{enterpriseIndex}}"
          bindchange="onEnterpriseChange"
        >
          <view class="picker">
            <text class="picker-text">{{enterprises[enterpriseIndex].name}}</text>
            <text class="picker-arrow">▼</text>
          </view>
        </picker>
      </view>
      
      <!-- 企业名称输入框（当选择"其他"时显示） -->
      <view class="form-item" wx:if="{{showEnterpriseNameInput}}">
        <text class="label">企业名称</text>
        <input 
          class="input" 
          placeholder="请输入企业名称" 
          value="{{registerForm.enterpriseName}}"
          bindinput="onRegisterInput"
          data-field="enterpriseName"
        />
      </view>
      
      <button 
        class="btn-primary" 
        bindtap="handleRegister"
        loading="{{registerLoading}}"
      >
        注册
      </button>
    </view>
  </view>

  <!-- 退出登录按钮 -->
  <view class="logout-section" wx:if="{{userInfo}}">
    <button class="btn-secondary" bindtap="handleLogout">
      退出登录
    </button>
  </view>
</view>
