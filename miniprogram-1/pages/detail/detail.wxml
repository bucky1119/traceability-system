<view class="container">
  <!-- è°ƒè¯•ä¿¡æ¯ -->
  <view class="debug-info" style="background: #f0f0f0; padding: 10rpx; margin: 10rpx; font-size: 24rpx; color: #666;">
    <text>è°ƒè¯•ä¿¡æ¯: äº§å“ID={{productId}}, äº§å“æ•°æ®: {{product ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}}</text>
  </view>

  <!-- äº§å“åŸºæœ¬ä¿¡æ¯ -->
  <view class="product-header">
    <view class="product-image">
      <image 
        src="{{product.imageUrl || '/images/default-product.jpg'}}" 
        mode="aspectFill"
      />
      <view class="product-status {{product.isQualified ? 'qualified' : 'unqualified'}}">
        {{product.isQualified ? 'åˆæ ¼' : 'ä¸åˆæ ¼'}}
      </view>
    </view>
    
    <view class="product-info">
      <text class="product-name">{{product.name}}</text>
      <text class="product-batch">æ‰¹æ¬¡ç¼–å·: {{product.batch.batchCode}}</text>
      <text class="product-origin" wx:if="{{product.origin}}">äº§åœ°: {{product.origin}}</text>
      <text class="product-producer">ç”Ÿäº§è€…: {{product.producerName}}</text>
    </view>
  </view>

  <!-- è¯¦ç»†ä¿¡æ¯ -->
  <view class="detail-sections">
    <!-- ç§æ¤ä¿¡æ¯ -->
    <view class="detail-section">
      <view class="section-title">
        <text class="title-icon">ğŸŒ±</text>
        <text class="title-text">ç§æ¤ä¿¡æ¯</text>
      </view>
      
      <view class="info-grid">
        <view class="info-item" wx:if="{{product.plantingDate}}">
          <text class="info-label">ç§æ¤æ—¥æœŸ</text>
          <text class="info-value">{{product.plantingDate}}</text>
        </view>
        
        <view class="info-item" wx:if="{{product.harvestDate}}">
          <text class="info-label">æ”¶è·æ—¥æœŸ</text>
          <text class="info-value">{{product.harvestDate}}</text>
        </view>
        
        <view class="info-item" wx:if="{{product.origin}}">
          <text class="info-label">äº§åœ°</text>
          <text class="info-value">{{product.origin}}</text>
        </view>
      </view>
    </view>

    <!-- æ£€æµ‹ä¿¡æ¯ -->
    <view class="detail-section">
      <view class="section-title">
        <text class="title-icon">ğŸ”¬</text>
        <text class="title-text">æ£€æµ‹ä¿¡æ¯</text>
      </view>
      
      <view class="info-grid">
        <view class="info-item" wx:if="{{product.testType}}">
          <text class="info-label">æ£€æµ‹ç±»å‹</text>
          <text class="info-value">{{product.testType}}</text>
        </view>
        
        <view class="info-item" wx:if="{{product.testDate}}">
          <text class="info-label">æ£€æµ‹æ—¥æœŸ</text>
          <text class="info-value">{{product.testDate}}</text>
        </view>
        
        <view class="info-item">
          <text class="info-label">æ£€æµ‹ç»“æœ</text>
          <text class="info-value {{product.isQualified ? 'qualified' : 'unqualified'}}">
            {{product.isQualified ? 'åˆæ ¼' : 'ä¸åˆæ ¼'}}
          </text>
        </view>
        
        <view class="info-item" wx:if="{{product.testReport}}">
          <text class="info-label">æ£€æµ‹æŠ¥å‘Š</text>
          <text class="info-link" bindtap="openTestReport">æŸ¥çœ‹æŠ¥å‘Š</text>
        </view>
        
        <view class="info-item" wx:if="{{product.safetyRiskTest}}">
          <text class="info-label">å®‰å…¨é£é™©å› å­æ£€æµ‹</text>
          <text class="info-value">{{product.safetyRiskTest}}</text>
        </view>
        
        <view class="info-item" wx:if="{{product.ingredientTest}}">
          <text class="info-label">äº§å“æˆåˆ†æ£€æµ‹</text>
          <text class="info-value">{{product.ingredientTest}}</text>
        </view>
      </view>
    </view>

    <!-- ç”Ÿäº§è€…ä¿¡æ¯ -->
    <view class="detail-section">
      <view class="section-title">
        <text class="title-icon">ğŸ‘¨â€ğŸŒ¾</text>
        <text class="title-text">ç”Ÿäº§è€…ä¿¡æ¯</text>
      </view>
      
      <view class="producer-card">
        <view class="producer-avatar">
          <image src="/images/avatar.png" mode="aspectFill"/>
        </view>
        
        <view class="producer-info">
          <text class="producer-name">{{product.producerName}}</text>
          <text class="producer-phone" wx:if="{{product.producerTel}}">{{product.producerTel}}</text>
          <text class="producer-enterprise" wx:if="{{product.producerEnterprise}}">{{product.producerEnterprise}}</text>
        </view>
      </view>
    </view>

    <!-- æ‰¹æ¬¡ä¿¡æ¯ -->
    <view class="detail-section">
      <view class="section-title">
        <text class="title-icon">ğŸ“¦</text>
        <text class="title-text">æ‰¹æ¬¡ä¿¡æ¯</text>
      </view>
      
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">æ‰¹æ¬¡ç¼–å·</text>
          <text class="info-value">{{product.batch.batchCode}}</text>
        </view>
        
        <view class="info-item" wx:if="{{product.batch.createTime}}">
          <text class="info-label">åˆ›å»ºæ—¶é—´</text>
          <text class="info-value">{{product.batch.createTime}}</text>
        </view>
        
        <view class="info-item" wx:if="{{product.batch.notes}}">
          <text class="info-label">æ‰¹æ¬¡å¤‡æ³¨</text>
          <text class="info-value">{{product.batch.notes}}</text>
        </view>
      </view>
    </view>

    <!-- äºŒç»´ç ä¿¡æ¯ -->
    <view class="detail-section" wx:if="{{qrcodes.length > 0}}">
      <view class="section-title">
        <text class="title-icon">ğŸ“±</text>
        <text class="title-text">äºŒç»´ç ä¿¡æ¯</text>
      </view>
      
      <view class="qrcode-list">
        <view 
          class="qrcode-item" 
          wx:for="{{qrcodes}}" 
          wx:key="id"
        >
          <view class="qrcode-content" bindtap="previewQrcode" data-qrcode="{{item}}">
            <image 
              class="qrcode-thumbnail" 
              src="{{item.qrcodeImageUrl}}" 
              mode="aspectFit"
            />
            <view class="qrcode-info">
              <text class="qrcode-id">ID: {{item.qrcodeId}}</text>
              <text class="qrcode-scans">æ‰«ç æ¬¡æ•°: {{item.scanCount}}</text>
              <text class="qrcode-time">ç”Ÿæˆæ—¶é—´: {{item.generateTime}}</text>
            </view>
          </view>
          
          <view class="qrcode-actions">
            <button 
              class="qrcode-action-btn save-btn" 
              bindtap="saveQrcodeToAlbum"
              data-qrcode="{{item}}"
            >
              ä¿å­˜
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn-secondary" bindtap="handleEdit">ç¼–è¾‘äº§å“</button>
    <button class="btn-primary" bindtap="handleGenerateQrcode">ç”ŸæˆäºŒç»´ç </button>
    <button class="btn-danger" bindtap="handleDelete">åˆ é™¤äº§å“</button>
  </view>

  <!-- äºŒç»´ç å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showQrcodeModal}}" bindtap="closeQrcodeModal">
    <view class="modal-content" catchtap="true">
      <view class="modal-header">
        <text class="modal-title">ç”Ÿæˆçš„äºŒç»´ç </text>
        <text class="modal-close" bindtap="closeQrcodeModal">Ã—</text>
      </view>
      
      <view class="qrcode-container">
        <image 
          class="qrcode-image" 
          src="{{currentQrcode.imageUrl}}" 
          mode="aspectFit"
          bindtap="previewQrcode"
        />
        <text class="qrcode-tip">ç‚¹å‡»å›¾ç‰‡å¯æ”¾å¤§æŸ¥çœ‹</text>
      </view>
      
      <view class="qrcode-info">
        <text class="info-item">äº§å“: {{currentQrcode.productName}}</text>
        <text class="info-item">æ‰¹æ¬¡: {{currentQrcode.batchCode}}</text>
        <text class="info-item">äºŒç»´ç ID: {{currentQrcode.qrcodeId}}</text>
        <text class="info-item">ç”Ÿæˆæ—¶é—´: {{currentQrcode.generateTime}}</text>
      </view>
      
      <view class="modal-actions">
        <button class="btn-primary" bindtap="saveToAlbum">
          ä¿å­˜åˆ°æœ¬åœ°
        </button>
      </view>
    </view>
  </view>
</view>
