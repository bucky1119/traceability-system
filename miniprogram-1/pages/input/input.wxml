<view class="container">
  <view class="header">
    <text class="title">{{isEditMode ? '编辑产品信息' : '录入产品信息'}}</text>
    <text class="subtitle">{{isEditMode ? '请修改蔬菜的基本信息和检测数据' : '请填写蔬菜的基本信息和检测数据，提交后可在"我的产品"页面生成二维码'}}</text>
  </view>

  <!-- 产品信息（单独提交） -->
  <view class="form-section">
    <view class="section-title">产品信息</view>

    <view class="form-item">
      <text class="label required">产品名称</text>
      <input class="input" placeholder="请输入蔬菜名称" value="{{productForm.name}}" bindinput="onInput" data-field="name" />
    </view>

    <view class="form-item">
      <text class="label">品种（可选）</text>
      <input class="input" placeholder="请输入蔬菜品种（可选）" value="{{productForm.vegetableVariety}}" bindinput="onInput" data-field="vegetableVariety" />
    </view>

    <view class="form-item">
      <text class="label required">产地</text>
      <input class="input" placeholder="请输入产地信息" value="{{productForm.origin}}" bindinput="onInput" data-field="origin" />
    </view>

    <view class="form-item">
      <text class="label required">种植日期</text>
      <picker mode="date" value="{{productForm.plantingDate}}" bindchange="onDateChange" data-field="plantingDate">
        <view class="picker">
          <text class="picker-text">{{productForm.plantingDate || '请选择种植日期'}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label required">收获日期</text>
      <picker mode="date" value="{{productForm.harvestDate}}" bindchange="onDateChange" data-field="harvestDate">
        <view class="picker">
          <text class="picker-text">{{productForm.harvestDate || '请选择收获日期'}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">产品图片</text>
      <view class="image-upload">
        <view class="upload-area" bindtap="chooseImage" wx:if="{{!productForm.imageUrl}}">
          <text class="upload-icon">+</text>
          <text class="upload-text">点击上传图片</text>
        </view>
        <view class="image-preview" wx:if="{{productForm.imageUrl}}">
          <image class="preview-image" src="{{productForm.imageUrl}}" mode="aspectFill" bindtap="previewImage" />
          <view class="image-actions">
            <button class="btn-small" bindtap="chooseImage">重新上传</button>
            <button class="btn-small btn-danger" bindtap="removeImage">删除</button>
          </view>
        </view>
      </view>
    </view>

    <view class="form-item">
      <text class="label">描述（可选）</text>
      <textarea class="textarea" placeholder="请输入描述信息（可选）" value="{{productForm.description}}" bindinput="onInput" data-field="batchNotes" maxlength="200" />
      <text class="char-count">{{productForm.description.length}}/200</text>
    </view>

    <view class="form-actions">
      <button class="btn-secondary" bindtap="handleReset" disabled="{{submitting}}">重置</button>
      <button class="btn-primary" bindtap="handleCreateProduct" loading="{{submitting}}">{{isEditMode ? '更新产品' : '提交产品'}}</button>
    </view>
  </view>

  <!-- 安检信息（单独提交） -->
  <view class="form-section">
    <view class="section-title">安检信息</view>

    <view class="tip" wx:if="{{!createdBatchId && !isEditMode}}">请先提交产品，才能提交安检信息</view>

    <view class="form-item">
      <text class="label required">风险因子类型</text>
      <input class="input" placeholder="如：农药残留检测" value="{{safetyForm.riskFactorType}}" bindinput="onInput" data-field="riskFactorType" />
    </view>

    <view class="form-item">
      <text class="label required">检测日期</text>
      <picker mode="date" value="{{safetyForm.inspectionDate}}" bindchange="onDateChange" data-field="inspectionDate">
        <view class="picker">
          <text class="picker-text">{{safetyForm.inspectionDate || '请选择检测日期'}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">产品成分检测（可选）</text>
      <textarea class="textarea" placeholder="如：蛋白质：2.1g/100g，维生素C：15mg/100g" value="{{safetyForm.componentAnalysis}}" bindinput="onInput" data-field="componentAnalysis" maxlength="500" />
      <text class="char-count">{{safetyForm.componentAnalysis.length}}/500</text>
    </view>

    <view class="form-item">
      <text class="label">安检图片（可选）</text>
      <view class="image-upload">
        <view class="upload-area" bindtap="chooseSafetyImage" wx:if="{{!safetyForm.resultImagePath}}">
          <text class="upload-icon">+</text>
          <text class="upload-text">点击上传安检图片</text>
        </view>
        <view class="image-preview" wx:if="{{safetyForm.resultImagePath}}">
          <image class="preview-image" src="{{safetyForm.resultImagePath}}" mode="aspectFill" bindtap="previewSafetyImage" />
          <view class="image-actions">
            <button class="btn-small" bindtap="chooseSafetyImage">重新上传</button>
            <button class="btn-small btn-danger" bindtap="removeSafetyImage">删除</button>
          </view>
        </view>
      </view>
    </view>

    <view class="form-item">
      <text class="label">是否合格</text>
      <switch checked="{{safetyForm.isQualified}}" bindchange="onSwitchChange" data-field="isQualified" color="#4caf50" />
    </view>

    <view class="form-actions">
      <button class="btn-primary" bindtap="handleCreateSafety" loading="{{submitting}}" disabled="{{!createdBatchId && !isEditMode}}">提交安检信息</button>
    </view>
  </view>


</view>
